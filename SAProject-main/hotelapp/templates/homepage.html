{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…’åº—å¾Œå°ç®¡ç†ç³»çµ±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #e67e22;
            --success-color: #2ecc71;
            --background-color: #f8f9fa;
            --text-color: #2c3e50;
            --border-color: #ddd;
            --hover-color: #34495e;
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            display: flex;
            min-height: 100vh;
            color: var(--text-color);
        }
        aside {
            width: 220px;
            background: var(--primary-color);
            padding: 30px 0;
            min-height: 100vh;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        aside::before {
            content: 'ğŸ¨';
            display: block;
            font-size: 40px;
            text-align: center;
            margin-bottom: 20px;
            color: white;
        }

        aside ul {
            list-style: none;
            padding: 0;
            margin-top: 40px;
        }

        aside li {
            margin: 8px 20px;
        }

        aside button {
            width: 100%;
            padding: 12px 15px;
            border: none;
            background: transparent;
            color: rgba(255,255,255,0.8);
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        aside button::before {
            margin-right: 10px;
            font-size: 18px;
        }

        aside button:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        aside button.active {
            background: var(--secondary-color);
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        #nav-room::before { content: 'ğŸ '; }
        #nav-reserve::before { content: 'ğŸ“…'; }
        #nav-promo::before { content: 'ğŸ·ï¸'; }
        main {
            flex: 1;
            padding: 0;
        }
        .content-section {
            display: none;
            padding: 20px;
        }
        .content-section.active {
            display: block;
        }

        h1 {
            text-align: center;
            font-size: 40px;
            font-weight: bold;
            margin: 30px 0 40px 0;
            letter-spacing: 2px;
            color: #2c3e50;
            text-shadow: 2px 2px 8px #e0e0e0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            padding: 20px;
        }

        .room-card {
            background-color: white;
            border: none;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .room-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-color);
        }

        .room-card[data-status="ä½¿ç”¨ä¸­"]::before {
            background: var(--success-color);
        }

        .room-card[data-status="å·²é ç´„"]::before {
            background: var(--secondary-color);
        }

        .room-header {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 12px;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* æˆ¿é–“ç‹€æ…‹é¡è‰²å€åˆ† */
        .room-status[data-status="ç©ºæˆ¿"] {
            background: #eafaf1;
            color: #27ae60;
            border: 1.5px solid #2ecc71;
        }
        .room-status[data-status="ä½¿ç”¨ä¸­"] {
            background: #eaf3fa;
            color: #2980b9;
            border: 1.5px solid #3498db;
        }
        .room-status[data-status="å·²é ç´„"] {
            background: #fff4e6;
            color: #e67e22;
            border: 1.5px solid #e67e22;
        }

        .room-status {
            margin: 15px 0;
            padding: 8px 12px;
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
            font-size: 0.9em;
        }

        .room-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .room-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .room-actions form {
            flex: 1;
        }

        .room-actions button {
            width: 100%;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .room-actions button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .checkin { background-color: #2ecc71; color: white; }
        .checkout { background-color: #e67e22; color: white; }

        #floor-buttons {
            text-align: center;
            margin-top: 20px;
        }

        .floor-btn {
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            margin: 0 4px;
        }

        .floor-btn.active {
            background-color: #2980b9;
            color: white;
        }

        #checkin-modal {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        #checkin-modal .modal-content {
            background: #fff;
            max-width: 350px;
            margin: 80px auto;
            padding: 24px;
            border-radius: 8px;
            position: relative;
        }

        #checkin-modal h3 {
            margin-top: 0;
        }

        #checkin-modal label {
            display: block;
            margin-bottom: 8px;
        }

        #checkin-modal input {
            width: 100%;
            padding: 8px;
            margin-bottom: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #checkin-modal .modal-actions {
            display: flex;
            justify-content: space-between;
        }

        #checkin-modal .modal-actions button {
            flex: 1;
            margin: 0 4px;
        }

        /* é ç´„æœå‹™å€å¡Šæ¨£å¼ */
        #section-reserve {
            background: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)),
                        url('https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            padding: 40px;
            position: relative;
        }

        .reservation-form {
            max-width: 500px;
            margin: 20px auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .reservation-form h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 700;
        }

        .reservation-form .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .reservation-form label {
            display: block;
            margin-bottom: 8px;
            color: #34495e;
            font-weight: 500;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .reservation-form input,
        .reservation-form select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .reservation-form input:focus,
        .reservation-form select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .reservation-form button[type="submit"] {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .reservation-form button[type="submit"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
        }

        /* é ç´„åˆ—è¡¨æ¨£å¼ */
        .reservation-list {
            max-width: 900px;
            margin: 40px auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .reservation-list h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: 700;
        }

        .reservation-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .reservation-table th {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 500;
            font-size: 14px;
            text-transform: uppercase;
        }

        .reservation-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            color: #2c3e50;
        }

        .reservation-table tr:hover {
            background: #f8f9fa;
        }

        /* ä¿ƒéŠ·è¡¨å–®æ¨£å¼ */
        #section-promo {
            background: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)),
                        url('https://images.unsplash.com/photo-1618773928121-c32242e63f39?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            padding: 40px;
            position: relative;
        }
        
        #section-promo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            pointer-events: none;
        }

        .promotion-form {
<<<<<<< HEAD
            max-width: 800px;
            margin: 0 auto;
=======
            max-width: 500px;
>>>>>>> a86f24e7b57a4b773b0ed7604206baf960c7c735
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .promotion-form h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
            font-size: 24px;
        }

        .promotion-form .form-group {
            margin-bottom: 20px;
        }

        .promotion-form label {
            display: block;
            margin-bottom: 8px;
            color: #34495e;
            font-weight: 500;
        }

<<<<<<< HEAD
        .promotion-form input, 
        .promotion-form select,
        .promotion-form textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
=======
        .promotion-form input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
>>>>>>> a86f24e7b57a4b773b0ed7604206baf960c7c735
            transition: border-color 0.3s ease;
        }

        .promotion-form input:focus {
            border-color: #3498db;
            outline: none;
        }

        .promotion-form button[type="submit"] {
            width: 100%;
            padding: 12px;
            background-color: #e67e22;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .promotion-form button[type="submit"]:hover {
            background-color: #d35400;
        }

        /* å–æ¶ˆé ç´„çš„æç¤ºæ¡†æ¨£å¼ */
        #cancel-modal {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.2);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        #cancel-modal .modal-content {
            background: #fff;
            padding: 30px 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px #0002;
            text-align: center;
        }

        #cancel-modal h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 500;
        }

        #cancel-modal button {
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #cancel-modal #confirm-cancel-btn {
            background: #e74c3c;
            color: #fff;
            margin-right: 20px;
        }

        #cancel-modal #confirm-cancel-btn:hover {
            background: #c0392b;
        }

        #cancel-modal #cancel-cancel-btn {
            background: #bbb;
            color: #fff;
        }

        #cancel-modal #cancel-cancel-btn:hover {
            background: #999;
        }
    </style>
</head>
<body>
<aside>
    <ul>
        <li><button id="nav-room" class="active" onclick="showSection('room')">æ“ä½œæˆ¿é–“</button></li>
        <li><button id="nav-reserve" onclick="showSection('reserve')">é ç´„æœå‹™</button></li>
        <li><button id="nav-promo" onclick="showSection('promo')">å»ºç«‹ä¿ƒéŠ·</button></li>
    </ul>
</aside>
<main>
    <!-- æ¶ˆæ¯é¡¯ç¤ºå€ï¼ˆæ”¾åœ¨ main æœ€ä¸Šæ–¹ï¼Œæ‰€æœ‰åˆ†é éƒ½æœƒé¡¯ç¤ºï¼‰ -->
    {% if messages %}
    <div class="messages" style="max-width: 500px; margin: 20px auto;">
        {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}" 
             style="padding: 15px; margin-bottom: 15px; border-radius: 4px; 
                    {% if message.tags == 'success' %}
                    background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;
                    {% else %}
                    background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
                    {% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    <script>
        // 3ç§’å¾Œè‡ªå‹•éš±è—æ‰€æœ‰æç¤ºè¨Šæ¯
        setTimeout(function() {
            document.querySelectorAll('.messages').forEach(function(el) {
                el.style.display = 'none';
            });
        }, 3000);
    </script>
    {% endif %}

    <!-- æ“ä½œæˆ¿é–“å€å¡Š -->
    <div id="section-room" class="content-section active">
        <h1>ğŸ¨ é…’åº—å¾Œå°ç®¡ç†ç³»çµ±</h1>
        <div style="display: flex; gap: 24px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
            <div class="room-status" data-status="ç©ºæˆ¿">ç©ºæˆ¿</div>
            <div class="room-status" data-status="ä½¿ç”¨ä¸­">ä½¿ç”¨ä¸­</div>
            <div class="room-status" data-status="å·²é ç´„">å·²é ç´„</div>
        </div>

        <div id="floor-buttons">
            <button class="floor-btn active" onclick="filterFloor('all', this)">å…¨éƒ¨</button>
            {% for floor in floors %}
                <button class="floor-btn" onclick="filterFloor('{{ floor }}', this)">{{ floor }}F</button>
            {% endfor %}
        </div>

        <div class="grid">
            {% for room in rooms %}
            <div class="room-card" data-floor="{{ room.room_number|slice:":1" }}" data-status="{{ room.status }}">
                <div class="room-header">
                    <span>{{ room.room_number }}</span>
                    <span class="room-type">{{ room.room_type.name }}</span>
                </div>
                <div class="room-info">
                    <div>
                        <i class="fas fa-building"></i> {{ room.room_number|slice:":1" }}F
                    </div>
                    <div>
                        <i class="fas fa-key"></i> {{ room.status }}
                    </div>
                </div>
                <div class="promotion-info" {% if room.promotion %}style="color: var(--secondary-color);"{% endif %}>
                    <i class="fas fa-tag"></i>
                    {% if room.promotion %}
<<<<<<< HEAD
                        {{ room.promotion.name }}ï¼ˆ{{ room.promotion.discount|multiply:100|floatformat:"0" }}æŠ˜ï¼‰
=======
                        {{ room.promotion.name }}ï¼ˆ{{ room.promotion.discount|floatformat:"0" }}æŠ˜ï¼‰
>>>>>>> a86f24e7b57a4b773b0ed7604206baf960c7c735
                    {% else %}
                        ç„¡ä¿ƒéŠ·æ´»å‹•
                    {% endif %}
                </div>
                <div class="room-status" data-status="{{ room.status }}" style="font-size:1.1em; font-weight:bold; margin-top:10px;">
                    <i class="fas fa-info-circle"></i> ç•¶å‰ç‹€æ…‹ï¼š<span style="font-size:1.15em;">{{ room.status }}</span>
                </div>
                <div class="room-actions">
                    {% if room.status == "ç©ºæˆ¿" or room.status == "å·²é ç´„" %}
                    <button class="checkin" type="button" onclick="openCheckinModal('{{ room.room_number }}')">
                        <i class="fas fa-sign-in-alt"></i> Check In
                    </button>
                    {% elif room.status == "ä½¿ç”¨ä¸­" %}
                    <form method="post" action="{% url 'checkout' room.room_number %}">
                        {% csrf_token %}
                        <button class="checkout" type="submit">
                            <i class="fas fa-sign-out-alt"></i> Check Out
                        </button>
                    </form>
                    {% else %}
                    <small>ç„¡å¯ç”¨æ“ä½œ</small>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div id="checkin-modal">
            <div class="modal-content">
                <h3>å…¥ä½ç™»è¨˜</h3>
                <form id="checkin-form" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="room_number" id="modal-room-number">
                    <div>
                        <label>èº«åˆ†è­‰è™Ÿï¼š</label>
                        <input type="text" name="national_id" required>
                    </div>
                    <div>
                        <label>å§“åï¼š</label>
                        <input type="text" name="name" required>
                    </div>
                    <div>
                        <label>æ‰‹æ©Ÿè™Ÿç¢¼ï¼š</label>
                        <input type="text" name="phone" required>
                    </div>
                    <div>
                        <label>äººæ•¸ï¼š</label>
                        <input type="number" name="guest_count" min="1" value="1" required>
                    </div>
                    <div>
                        <label>å¯„æ”¾è¡Œæï¼š</label>
                        <input type="checkbox" name="has_luggage" value="true">
                    </div>
                    <div class="modal-actions" style="margin-top:12px;">
                        <button type="submit" class="checkin">ç¢ºå®š</button>
                        <button type="button" onclick="closeCheckinModal()">å–æ¶ˆ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- é ç´„æœå‹™å€å¡Š -->
    <div id="section-reserve" class="content-section">
        <div class="reservation-form">
            <h2>
                <i class="fas fa-calendar-alt"></i> 
                é ç´„å…¥ä½
            </h2>
            <form method="post" action="{% url 'add_reservation' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label>èº«åˆ†è­‰å­—è™Ÿ</label>
                    <input type="text" name="national_id" required placeholder="è«‹è¼¸å…¥èº«åˆ†è­‰å­—è™Ÿ" pattern="[A-Z][12]\d{8}" title="è«‹è¼¸å…¥æ­£ç¢ºçš„èº«åˆ†è­‰æ ¼å¼">
                </div>
                <div class="form-group">
                    <label>è¨‚æˆ¿äººå§“å</label>
                    <input type="text" name="name" required placeholder="è«‹è¼¸å…¥å§“å">
                </div>
                <div class="form-group">
                    <label>è¯çµ¡é›»è©±</label>
                    <input type="tel" name="phone" required placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼" pattern="09\d{8}" title="è«‹è¼¸å…¥æ­£ç¢ºçš„æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼">
                </div>
                <div class="form-group">
                    <label>é è¨‚æˆ¿å‹</label>
                    <select name="room_number" required>
                        <option value="">è«‹é¸æ“‡æˆ¿å‹</option>
                        {% for room in rooms %}
                            {% if room.status == "ç©ºæˆ¿" %}
                                <option value="{{ room.room_number }}" data-max-guests="{% if room.room_type.name == 'å–®äººæˆ¿' %}1{% elif room.room_type.name == 'é›™äººæˆ¿' %}2{% elif room.room_type.name == 'å®¶åº­æˆ¿' %}4{% elif room.room_type.name == 'è±ªè¯æˆ¿' %}3{% else %}4{% endif %}">
                                    {{ room.room_type.name }} - {{ room.room_number }}è™Ÿæˆ¿
                                    {% if room.promotion %}
                                        ({{ room.promotion.name }})
                                    {% endif %}
                                </option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>å…¥ä½äººæ•¸</label>
                    <input type="number" name="guest_count" min="1" required value="1">
                    <small style="color: #7f8c8d;">æç¤ºï¼šé¸æ“‡æˆ¿å‹å¾Œæœƒé¡¯ç¤ºå¯å®¹ç´äººæ•¸</small>
                </div>
                <div class="form-group">
                    <label>å…¥ä½æ—¥æœŸ</label>
                    <input type="date" name="checkin_date" required min="{{ today|date:'Y-m-d' }}" onchange="updateNights()">
                </div>
                <div class="form-group">
                    <label>é€€æˆ¿æ—¥æœŸ</label>
                    <input type="date" name="checkout_date" required min="{{ today|date:'Y-m-d' }}" onchange="updateNights()">
                </div>
                <div class="form-group">
                    <label>ä½å®¿å¤©æ•¸</label>
                    <input type="number" name="nights" min="1" required readonly>
                </div>
                <button type="submit">
                    <i class="fas fa-check"></i> ç¢ºèªé ç´„
                </button>
            </form>
        </div>

        <div class="reservation-list">
            <h2>
                <i class="fas fa-list"></i> 
                ç›®å‰é ç´„æ¸…å–®
            </h2>
            <table class="reservation-table">
                <thead>
                    <tr>
                        <th>è¨‚æˆ¿è³‡è¨Š</th>
                        <th>è¯çµ¡è³‡è¨Š</th>
                        <th>å…¥ä½æœŸé–“</th>
                        <th>ä½å®¿å¤©æ•¸</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in reservations %}
                    <tr class="reservation-row" data-id="{{ r.id }}">
                        <td>
                            <strong>{{ r.room.room_type.name }}</strong><br>
                            <small style="color: #7f8c8d;">{{ r.room.room_number }}è™Ÿæˆ¿</small>
                        </td>
                        <td>
                            {{ r.customer.name }}<br>
                            <small style="color: #7f8c8d;">{{ r.customer.phone }}</small>
                        </td>
                        <td>
                            {{ r.checkin_date|date:"Y/m/d" }} - {{ r.checkout_date|date:"Y/m/d" }}
                        </td>
                        <td style="text-align: center;">
                            <span style="color: #e67e22; font-weight: bold;">{{ r.nights }}</span> æ™š
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 30px; color: #7f8c8d;">
                            <i class="fas fa-info-circle"></i> ç›®å‰æ²’æœ‰ä»»ä½•é ç´„
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <!-- å»ºç«‹ä¿ƒéŠ·å€å¡Š -->
    <div id="section-promo" class="content-section">
        <!-- æ¶ˆæ¯é¡¯ç¤ºå€ -->
        {% if messages %}
        <div class="messages" style="max-width: 500px; margin: 20px auto;">
            {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}" 
                 style="padding: 15px; margin-bottom: 15px; border-radius: 4px; 
                        {% if message.tags == 'success' %}
                        background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;
                        {% else %}
                        background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
                        {% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        <div class="promotion-form">
            <h2>ğŸ·ï¸ å»ºç«‹ä¿ƒéŠ·æ–¹æ¡ˆ</h2>
<<<<<<< HEAD
            <form method="post" action="{% url 'add_promotion' %}" onsubmit="return validatePromotionForm()">
                {% csrf_token %}
                <div class="form-group">
                    <label for="promo-name">ä¿ƒéŠ·åç¨±</label>
                    <input type="text" id="promo-name" name="name" required 
                           style="width: 100%; padding: 10px;" 
                           placeholder="è«‹è¼¸å…¥ä¿ƒéŠ·åç¨±">
                </div>
                <div class="form-group">
                    <label for="promo-code">ä¿ƒéŠ·ä»£ç¢¼</label>
                    <input type="text" id="promo-code" name="code" required 
                           style="width: 100%; padding: 10px;" 
                           placeholder="è«‹è¼¸å…¥ä¿ƒéŠ·ä»£ç¢¼ (å¦‚ï¼šSUMMER23)">
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>é–‹å§‹æ—¥æœŸ</label>
                        <input type="date" name="start_date" style="width: 100%; padding: 8px;">
                    </div>
                    <div class="form-group">
                        <label>çµæŸæ—¥æœŸ</label>
                        <input type="date" name="end_date" style="width: 100%; padding: 8px;">
                    </div>
=======
            <form method="post" action="{% url 'add_promotion' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label>ä¿ƒéŠ·åç¨±</label>
                    <select name="name" required style="width: 100%; padding: 10px;">
                        <option value="">è«‹é¸æ“‡ä¿ƒéŠ·åç¨±</option>
                        <option value="å–®äººæˆ¿ä¹æŠ˜">å–®äººæˆ¿ä¹æŠ˜</option>
                        <option value="é›™äººæˆ¿å…«æŠ˜">é›™äººæˆ¿å…«æŠ˜</option>
                        <option value="å®¶åº­æˆ¿å…«äº”æŠ˜">å®¶åº­æˆ¿å…«äº”æŠ˜</option>
                        <option value="è±ªè¯æˆ¿å…«å…«æŠ˜">è±ªè¯æˆ¿å…«å…«æŠ˜</option>
                        <option value="å¥—æˆ¿å…«äºŒæŠ˜">å¥—æˆ¿å…«äºŒæŠ˜</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ä¿ƒéŠ·ä»£ç¢¼</label>
                    <select name="code" required style="width: 100%; padding: 10px;">
                        <option value="">è«‹é¸æ“‡ä¿ƒéŠ·ä»£ç¢¼</option>
                        <option value="PROMO10">PROMO10 - å–®äººæˆ¿ä¹æŠ˜</option>
                        <option value="PROMO20">PROMO20 - é›™äººæˆ¿å…«æŠ˜</option>
                        <option value="PROMO15">PROMO15 - å®¶åº­æˆ¿å…«äº”æŠ˜</option>
                        <option value="PROMO12">PROMO12 - è±ªè¯æˆ¿å…«å…«æŠ˜</option>
                        <option value="PROMO18">PROMO18 - å¥—æˆ¿å…«äºŒæŠ˜</option>
                    </select>
>>>>>>> a86f24e7b57a4b773b0ed7604206baf960c7c735
                </div>
                <div class="form-group">
                    <label>æˆ¿å‹</label>
                    <select name="room_type" required style="width: 100%; padding: 10px;" id="room-type-select">
                        <option value="">è«‹é¸æ“‡æˆ¿å‹</option>
                        {% for room_type in room_types %}
                            <option value="{{ room_type.code }}" data-type="{{ room_type.name }}">{{ room_type.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>æŠ˜æ‰£</label>
<<<<<<< HEAD
                    <input type="number" name="discount" required style="width: 100%; padding: 10px;" 
                           placeholder="è«‹è¼¸å…¥æŠ˜æ‰£ï¼ˆä¾‹ï¼š0.85 ä»£è¡¨85æŠ˜ï¼‰"
                           min="0.1" max="0.99" step="0.01"
                           id="discount-input">
=======
                    <select name="discount" required style="width: 100%; padding: 10px;" id="discount-select">
                        <option value="">è«‹é¸æ“‡æŠ˜æ‰£</option>
                        <option value="0.90">9æŠ˜</option>
                        <option value="0.88">88æŠ˜</option>
                        <option value="0.85">85æŠ˜</option>
                        <option value="0.82">82æŠ˜</option>
                        <option value="0.80">8æŠ˜</option>
>>>>>>> a86f24e7b57a4b773b0ed7604206baf960c7c735
                    </select>
                </div>
                <button type="submit">å»ºç«‹ä¿ƒéŠ·</button>
            </form>
            
            <!-- é¡¯ç¤ºç¾æœ‰ä¿ƒéŠ· -->
            <div class="existing-promotions" style="margin-top: 30px;">
                <h3 style="color: #2c3e50; text-align: center; margin-bottom: 15px;">
                    <i class="fas fa-tags"></i> ç¾æœ‰ä¿ƒéŠ·æ–¹æ¡ˆ
                </h3>
<<<<<<< HEAD
                <div style="max-width: 800px; margin: 0 auto;">
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table style="width: 100%; border-collapse: collapse; margin-top: 10px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: #34495e; color: white;">
                                <th style="padding: 12px; text-align: center;">ä¿ƒéŠ·åç¨±</th>
                                <th style="padding: 12px; text-align: center;">ä»£ç¢¼</th>
                                <th style="padding: 12px; text-align: center;">é©ç”¨æˆ¿å‹</th>
                                <th style="padding: 12px; text-align: center;">æŠ˜æ‰£</th>
                                <th style="padding: 12px; text-align: center;">æœ‰æ•ˆæœŸé–“</th>
                                <th style="padding: 12px; text-align: center;">æ“ä½œ</th>
=======
                <div style="max-height: 300px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: #34495e; color: white;">
                                <th style="padding: 12px;">ä¿ƒéŠ·åç¨±</th>
                                <th style="padding: 12px;">ä»£ç¢¼</th>
                                <th style="padding: 12px;">é©ç”¨æˆ¿å‹</th>
                                <th style="padding: 12px;">æŠ˜æ‰£</th>
                                <th style="padding: 12px;">ç‹€æ…‹</th>
>>>>>>> a86f24e7b57a4b773b0ed7604206baf960c7c735
                            </tr>
                        </thead>
                        <tbody>
                            {% for promo in promotions %}
                            <tr style="border-bottom: 1px solid #eee; transition: background-color 0.3s;">
<<<<<<< HEAD
                                <td style="padding: 12px; text-align: left;">
                                    <div style="font-weight: 500;">{{ promo.name }}</div>
                                </td>
                                <td style="padding: 12px; text-align: center; font-family: monospace; color: #e67e22;">{{ promo.code }}</td>
                                <td style="padding: 12px; text-align: center;">{{ promo.room_type.name }}</td>
                                <td style="padding: 12px; text-align: center; color: #e67e22; font-weight: bold;">
                                    {{ promo.discount|multiply:100|floatformat:0 }}æŠ˜
                                </td>
                                <td style="padding: 12px; text-align: center;">
                                    {% if promo.start_date and promo.end_date %}
                                        {{ promo.start_date|date:"Y/m/d" }} - {{ promo.end_date|date:"Y/m/d" }}
                                    {% else %}
                                        ç„¡æœŸé™
                                    {% endif %}
                                </td>
                                <td style="padding: 12px; text-align: center;">
                                    <div style="display: flex; justify-content: center; gap: 10px; align-items: center;">
                                        {% if promo.is_valid %}
                                            <span style="background: #2ecc71; color: white; padding: 3px 8px; border-radius: 3px;">
                                                <i class="fas fa-check-circle"></i> ä½¿ç”¨ä¸­
                                            </span>
                                        {% else %}
                                            <span style="background: #95a5a6; color: white; padding: 3px 8px; border-radius: 3px;">
                                                <i class="fas fa-pause-circle"></i> å·²éæœŸ
                                            </span>
                                        {% endif %}
                                        <form method="post" action="{% url 'delete_promotion' promo.code %}" 
                                              onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ä¿ƒéŠ·æ–¹æ¡ˆå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚');">
                                            {% csrf_token %}
                                            <button type="submit" style="background: #e74c3c; color: white; border: none; 
                                                                       padding: 5px 10px; border-radius: 4px; cursor: pointer;
                                                                       transition: all 0.2s ease;">
                                                <i class="fas fa-trash-alt"></i> åˆªé™¤
                                            </button>
                                        </form>
                                    </div>
                                </td>
=======
                                <td style="padding: 12px;">{{ promo.name }}</td>
                                <td style="padding: 12px; font-family: monospace; color: #e67e22;">{{ promo.code }}</td>
                                <td style="padding: 12px;">{{ promo.room_type.name }}</td>
                                <td style="padding: 12px; color: #e67e22; font-weight: bold;">
                                    {{ promo.discount|multiply:100|floatformat:0 }}æŠ˜
                                </td>
                                <td style="padding: 12px;">
                                    {% if promo.rooms.all %}
                                    <span style="background: #2ecc71; color: white; padding: 3px 8px; border-radius: 3px;">
                                        <i class="fas fa-check-circle"></i> ä½¿ç”¨ä¸­
                                    </span>
                                    {% else %}
                                    <span style="background: #95a5a6; color: white; padding: 3px 8px; border-radius: 3px;">
                                        <i class="fas fa-pause-circle"></i> æœªä½¿ç”¨
                                    </span>
                                    {% endif %}
                                </td>
>>>>>>> a86f24e7b57a4b773b0ed7604206baf960c7c735
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 20px; color: #7f8c8d;">
                                    <i class="fas fa-info-circle"></i> ç›®å‰æ²’æœ‰ä»»ä½•ä¿ƒéŠ·æ–¹æ¡ˆ
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>
<script>
function filterFloor(floor, btn) {
    document.querySelectorAll('.floor-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.room-card').forEach(card => {
        if (floor === 'all' || card.getAttribute('data-floor') === floor) {
            card.style.display = '';
        } else {
            card.style.display = 'none';
        }
    });
}

function openCheckinModal(roomNumber) {
    document.getElementById('checkin-modal').style.display = 'block';
    document.getElementById('modal-room-number').value = roomNumber;
    document.getElementById('checkin-form').action = '/checkin/' + roomNumber + '/';
}

function closeCheckinModal() {
    document.getElementById('checkin-modal').style.display = 'none';
}

function showSection(section) {
    // åˆ‡æ›å·¦å´æŒ‰éˆ•
    document.querySelectorAll('aside button').forEach(btn => btn.classList.remove('active'));
    document.getElementById('nav-' + section).classList.add('active');
    // åˆ‡æ›å…§å®¹å€å¡Š
    document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
    document.getElementById('section-' + section).classList.add('active');
}

<<<<<<< HEAD
// ä¿ƒéŠ·è¡¨å–®é©—è­‰åŠŸèƒ½
function validatePromotionForm() {
    const form = document.querySelector('.promotion-form form');
    const nameInput = form.querySelector('input[name="name"]');
    const codeInput = form.querySelector('input[name="code"]');
    const discountInput = form.querySelector('input[name="discount"]');
    const roomTypeSelect = form.querySelector('select[name="room_type"]');
    const startDateInput = form.querySelector('input[name="start_date"]');
    const endDateInput = form.querySelector('input[name="end_date"]');
    
    console.log('è¡¨å–®å…ƒç´ :', {
        form: form,
        nameInput: nameInput,
        nameValue: nameInput ? nameInput.value : 'inputæœªæ‰¾åˆ°'
    });
    
    if (!nameInput || !nameInput.value || !nameInput.value.trim()) {
        alert('è«‹è¼¸å…¥ä¿ƒéŠ·åç¨±');
        if (nameInput) nameInput.focus();
        return false;
    }
    
    if (!codeInput.value.trim()) {
        alert('è«‹è¼¸å…¥ä¿ƒéŠ·ä»£ç¢¼');
        return false;
    }

    // æª¢æŸ¥ä¿ƒéŠ·ä»£ç¢¼æ ¼å¼
    if (!/^[A-Za-z0-9]+$/.test(codeInput.value.trim())) {
        alert('ä¿ƒéŠ·ä»£ç¢¼åªèƒ½åŒ…å«å­—æ¯å’Œæ•¸å­—');
        return false;
    }
    
    const discount = parseFloat(discountInput.value);
    if (isNaN(discount) || discount <= 0 || discount >= 1) {
        alert('æŠ˜æ‰£å¿…é ˆæ˜¯0åˆ°1ä¹‹é–“çš„æ•¸å­—ï¼ˆä¾‹ï¼š0.85ä»£è¡¨85æŠ˜ï¼‰');
        return false;
    }
    
    if (!roomTypeSelect.value) {
        alert('è«‹é¸æ“‡æˆ¿å‹');
        return false;
    }

    // å¦‚æœæœ‰å¡«å¯«é–‹å§‹æ—¥æœŸï¼ŒçµæŸæ—¥æœŸä¹Ÿå¿…é ˆå¡«å¯«
    if (startDateInput.value && !endDateInput.value) {
        alert('å¦‚æœè¨­å®šé–‹å§‹æ—¥æœŸï¼Œä¹Ÿå¿…é ˆè¨­å®šçµæŸæ—¥æœŸ');
        return false;
    }

    // å¦‚æœæœ‰å¡«å¯«çµæŸæ—¥æœŸï¼Œé–‹å§‹æ—¥æœŸä¹Ÿå¿…é ˆå¡«å¯«
    if (endDateInput.value && !startDateInput.value) {
        alert('å¦‚æœè¨­å®šçµæŸæ—¥æœŸï¼Œä¹Ÿå¿…é ˆè¨­å®šé–‹å§‹æ—¥æœŸ');
        return false;
    }

    // å¦‚æœéƒ½æœ‰å¡«å¯«æ—¥æœŸï¼Œæª¢æŸ¥æ—¥æœŸç¯„åœ
    if (startDateInput.value && endDateInput.value) {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        if (startDate < today) {
            alert('é–‹å§‹æ—¥æœŸä¸èƒ½æ˜¯éå»çš„æ—¥æœŸ');
            return false;
        }

        if (endDate < startDate) {
            alert('çµæŸæ—¥æœŸä¸èƒ½æ—©æ–¼é–‹å§‹æ—¥æœŸ');
            return false;
        }
    }
    
    return true;
=======
// ä¿ƒéŠ·è¡¨å–®è¯å‹•åŠŸèƒ½
const promotionData = {
    'å–®äººæˆ¿ä¹æŠ˜': { code: 'PROMO10', roomType: 'å–®äººæˆ¿', discount: '0.90' },
    'é›™äººæˆ¿å…«æŠ˜': { code: 'PROMO20', roomType: 'é›™äººæˆ¿', discount: '0.80' },
    'å®¶åº­æˆ¿å…«äº”æŠ˜': { code: 'PROMO15', roomType: 'å®¶åº­æˆ¿', discount: '0.85' },
    'è±ªè¯æˆ¿å…«å…«æŠ˜': { code: 'PROMO12', roomType: 'è±ªè¯æˆ¿', discount: '0.88' },
    'å¥—æˆ¿å…«äºŒæŠ˜': { code: 'PROMO18', roomType: 'å¥—æˆ¿', discount: '0.82' }
};

function updatePromotionFields(nameSelect) {
    const selectedName = nameSelect.value;
    const codeSelect = document.querySelector('select[name="code"]');
    const roomTypeSelect = document.getElementById('room-type-select');
    const discountSelect = document.getElementById('discount-select');
    
    if (selectedName && promotionData[selectedName]) {
        const data = promotionData[selectedName];
        
        // æ›´æ–°ä¿ƒéŠ·ä»£ç¢¼
        codeSelect.value = data.code;
        
        // æ›´æ–°æˆ¿å‹
        const roomTypeOption = Array.from(roomTypeSelect.options)
            .find(option => option.textContent === data.roomType);
        if (roomTypeOption) {
            roomTypeSelect.value = roomTypeOption.value;
        }
        
        // æ›´æ–°æŠ˜æ‰£
        discountSelect.value = data.discount;
        
        // ç¦ç”¨æ¬„ä½
        codeSelect.disabled = true;
        roomTypeSelect.disabled = true;
        discountSelect.disabled = true;
    } else {
        // é‡è¨­ä¸¦å•Ÿç”¨æ‰€æœ‰æ¬„ä½
        codeSelect.value = '';
        roomTypeSelect.value = '';
        discountSelect.value = '';
        
        codeSelect.disabled = false;
        roomTypeSelect.disabled = false;
        discountSelect.disabled = false;
    }
>>>>>>> a86f24e7b57a4b773b0ed7604206baf960c7c735
}

// é ç´„è¡¨å–®åŠŸèƒ½
function updateNights() {
    const checkinDate = document.querySelector('input[name="checkin_date"]').value;
    const checkoutDate = document.querySelector('input[name="checkout_date"]').value;
    const nightsInput = document.querySelector('input[name="nights"]');

    if (checkinDate && checkoutDate) {
        const start = new Date(checkinDate);
        const end = new Date(checkoutDate);
        const nights = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
        
        if (nights > 0) {
            nightsInput.value = nights;
        } else {
            alert('é€€æˆ¿æ—¥æœŸå¿…é ˆåœ¨å…¥ä½æ—¥æœŸä¹‹å¾Œ');
            document.querySelector('input[name="checkout_date"]').value = '';
            nightsInput.value = '';
        }
    }
}

// è¨­ç½®æœ€å°æ—¥æœŸ
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.querySelector('input[name="checkin_date"]').min = today;
    document.querySelector('input[name="checkout_date"]').min = today;
    
    // ç›£è½æˆ¿å‹é¸æ“‡è®ŠåŒ–ï¼Œæ›´æ–°äººæ•¸é™åˆ¶
    const roomSelect = document.querySelector('select[name="room_number"]');
    const guestCountInput = document.querySelector('input[name="guest_count"]');
    
    roomSelect.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const maxGuests = selectedOption.dataset.maxGuests;
        
        if (maxGuests) {
            guestCountInput.max = maxGuests;
            if (parseInt(guestCountInput.value) > parseInt(maxGuests)) {
                guestCountInput.value = maxGuests;
            }
            guestCountInput.nextElementSibling.textContent = `æç¤ºï¼šæ­¤æˆ¿å‹æœ€å¤šå¯å®¹ç´ ${maxGuests} äºº`;
        }
    });
    
    // é©—è­‰å…¥ä½äººæ•¸
    guestCountInput.addEventListener('change', function() {
        const selectedOption = roomSelect.options[roomSelect.selectedIndex];
        const maxGuests = selectedOption.dataset.maxGuests;
        
        if (maxGuests && parseInt(this.value) > parseInt(maxGuests)) {
            alert(`æ­¤æˆ¿å‹æœ€å¤šåªèƒ½å®¹ç´ ${maxGuests} äºº`);
            this.value = maxGuests;
        }
    });
    
    // ç›£è½æˆ¿å‹é¸æ“‡è®ŠåŒ–
    roomSelect.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        if (selectedOption.textContent.includes('ä¿ƒéŠ·')) {
            selectedOption.style.color = '#e67e22';
        }
    });
});

// é é¢è¼‰å…¥æ™‚æ·»åŠ äº‹ä»¶ç›£è½å™¨
document.addEventListener('DOMContentLoaded', function() {
    const nameSelect = document.querySelector('select[name="name"]');
    if (nameSelect) {
        nameSelect.addEventListener('change', function() {
            updatePromotionFields(this);
        });
    }

    // å–æ¶ˆé ç´„çš„å³éµèœå–®äº‹ä»¶
    let cancelId = null;
    document.querySelectorAll('.reservation-row').forEach(function(row) {
        row.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            cancelId = this.getAttribute('data-id');
            document.getElementById('cancel-modal').style.display = 'flex';
        });
    });
    document.getElementById('cancel-cancel-btn').onclick = function() {
        document.getElementById('cancel-modal').style.display = 'none';
        cancelId = null;
    };
    document.getElementById('confirm-cancel-btn').onclick = function() {
        if (!cancelId) return;
        fetch("{% url 'cancel_reservation' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: 'reservation_id=' + cancelId
        })
        .then(response => response.json())
        .then(data => {
            alert(data.msg);
            if (data.success) location.reload();
            else document.getElementById('cancel-modal').style.display = 'none';
        });
    };
});
</script>

<!-- å–æ¶ˆé ç´„çš„æç¤ºæ¡† -->
<div id="cancel-modal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.2); z-index:9999; align-items:center; justify-content:center;">
    <div class="modal-content">
        <h3>ç¢ºå®šè¦å–æ¶ˆé€™ç­†é ç´„å—ï¼Ÿ</h3>
        <button id="confirm-cancel-btn">ç¢ºèª</button>
        <button id="cancel-cancel-btn">å–æ¶ˆ</button>
    </div>
</div>
</body>
</html>